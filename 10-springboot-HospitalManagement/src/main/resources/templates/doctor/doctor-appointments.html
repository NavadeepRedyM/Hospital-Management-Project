<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Doctor Appointments</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .filter-container { margin-bottom: 20px; background: #f4f7fb; padding: 15px; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #0077b6; color: white; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .reason-cell { font-style: italic; color: #555; }
    </style>
</head>
<body>
<!-- Return to Doctor Panel (LEFT, OUTSIDE TABLE) -->
<div style="margin-bottom: 15px;">
<a th:href="@{/doctor/dashboard}"
          style="
              display: inline-block;
              padding: 8px 14px;
              background: #6c757d;
              color: white;
              text-decoration: none;
              border-radius: 4px;
          ">
           ← Return to Doctor Panel
</a>
</div>


<h2>All Appointments</h2>

<!-- ✅ Date Filter Input -->
<div class="filter-container">
    <label for="dateFilter"><strong>Filter by Date: </strong></label>
    <input type="date" id="dateFilter" onchange="filterByDate()" style="padding: 8px; border-radius: 4px; border: 1px solid #ccc;">
    <button onclick="resetFilter()" style="padding: 8px 12px; cursor: pointer;">Clear</button>
</div>

<table id="appointmentsTable">
    <thead>
        <tr>
            <th>Appt ID</th> <!-- ✅ Added Appointment ID Header -->
            <th>Patient ID</th>
            <th>Patient Name</th>
            <th>Date & Time</th>
            <th>Reason for Visit</th>
        </tr>
    </thead>
    <tbody>
        <tr th:each="appt : ${doctor.appointments}">
            <!-- ✅ Added Appointment ID Data -->
            <td th:text="${appt.id}"></td>
            
            <td th:text="${appt.patient != null ? appt.patient.id : 'N/A'}"></td>
            <td th:text="${appt.patient != null ? appt.patient.name : 'Unknown'}"></td>
            
            <!-- ✅ Column index for JS filtering is now 3 -->
            <td th:attr="data-date=${#temporals.format(appt.appointmentDate, 'yyyy-MM-dd')}">
                <span th:text="${appt.appointmentDate != null ? #temporals.format(appt.appointmentDate, 'dd-MM-yyyy') : 'N/A'}"></span>
                <br/>
                <small th:text="${appt.timeSlot}"></small>
            </td>
            
            <td class="reason-cell" th:text="${appt.reasonForVisit != null ? appt.reasonForVisit : 'No reason provided'}"></td>
        </tr>
    </tbody>
</table>

<script>
function filterByDate() {
    const selectedDate = document.getElementById('dateFilter').value; 
    const table = document.getElementById('appointmentsTable');
    const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');

    for (let i = 0; i < rows.length; i++) {
        // ✅ Index changed to [3] because Appt ID was added at [0]
        const dateCell = rows[i].getElementsByTagName('td')[3];
        if (!dateCell) continue;
        
        const rowDate = dateCell.getAttribute('data-date');
        
        if (!selectedDate || rowDate === selectedDate) {
            rows[i].style.display = "";
        } else {
            rows[i].style.display = "none";
        }
    }
}

function resetFilter() {
    document.getElementById('dateFilter').value = '';
    filterByDate();
}
</script>

</body>
</html>
